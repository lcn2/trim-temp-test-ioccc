<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- START: two lines up starts content from: inc/top.default.html -->
<!-- -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- -->
<!-- END: this line ends content from: inc/top.default.html -->
<!-- -->
<!-- This file was formed by the tool: bin/readme2index.sh version: 1.1.1 2024-01-20 -->
<!-- -->
<!-- START: this line starts content from: inc/head.default.html -->

<head>
<link rel="stylesheet" href="/temp-test-ioccc/ioccc.css">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>2001/coupard</title>
<meta name="description" content="2001 IOCCC winner coupard">
<meta name="keywords" content="IOCCC, 2001, IOCCC 2001, IOCCC winner, coupard">
</head>

<!-- END: this line ends content from: inc/head.default.html -->
<!-- START: this line starts content from: inc/body.default.html -->

<body>

<!-- END: this line ends content from: inc/body.default.html -->
<!-- START: this line starts content from: inc/header.default.html -->

<div class="header">
  <img src="/temp-test-ioccc/png/ioccc.png" alt="IOCCC image by Matt Zucker" width=300 height=110>
  <h1>The International Obfuscated C Code Contest</h1>
  <h2>2001/coupard</h2>
</div>

<!-- END: this line ends content from: inc/header.default.html -->
<!-- START: this line starts content from: inc/topnav.mid.html -->

<div class="topnav">
  <a class="Left" href="../cheong/index.html">&larr; cheong</a>
  <a class="Left" href="../index.html">&uarr; 2001 &uarr;</a>
  <a class="Left" href="../ctk/index.html">ctk &rarr;</a>
  <a class="Right" href="#inventory">Inventory</a>
</div>

<!-- END: this line ends content from: inc/topnav.mid.html -->
<!-- START: this line starts content from: inc/begin-row.default.html -->

<div class="row">

<!-- END: this line ends content from: inc/begin-row.default.html -->
<!-- START: this line starts content from: inc/begin-leftcolumn.default.html -->

  <div class="leftcolumn">

<!-- END: this line ends content from: inc/begin-leftcolumn.default.html -->
<!-- START: this line starts content from: inc/sidenav.default.html -->

    <div class="sidenav">
      <a href="#content">Jump to contents</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="/temp-test-ioccc/index.html">IOCCC Home</a>
      <a href="/temp-test-ioccc/years.html">Winning Entries</a>
      <a href="/temp-test-ioccc/winners.html">People who have won</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="/temp-test-ioccc/news.html">IOCCC News</a>
      <a href="/temp-test-ioccc/faq.html#submit">How to enter the IOCCC</a>
      <a href="/temp-test-ioccc/faq.html">FAQ</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="/temp-test-ioccc/bugs.html">Bugs &amp; (mis)features</a>
      <a href="/temp-test-ioccc/faq.html#fix_a_winner">Fixing IOCCC winners</a>
      <a href="/temp-test-ioccc/faq.html#fix_web_site">Fixing the web site</a>
      <a href="/temp-test-ioccc/faq.html#fix_author">Fixing winner info</a>
      <a href="/temp-test-ioccc/thanks-for-help.html">Thanks for the help</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="/temp-test-ioccc/judges.html">The IOCCC Judges</a>
      <a href="/temp-test-ioccc/contact.html">Contacting the IOCCC</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="#top">Jump to top</a>
    </div>

<!-- END: this line ends content from: inc/sidenav.default.html -->
<!-- START: this line starts content from: inc/end-leftcolumn.default.html -->

  </div>

<!-- END: this line ends content from: inc/end-leftcolumn.default.html -->
<!-- START: this line starts content from: inc/begin-rightcolumn.default.html -->

  <div class="rightcolumn">

<!-- END: this line ends content from: inc/begin-rightcolumn.default.html -->
<!-- START: this line starts content from: inc/before-content.default.html -->

    <a name="content"></a>

<!-- END: this line ends content from: inc/before-content.default.html -->
<!-- START: this line starts content generated by: bin/gen-author.sh -->

<p><a name="author"><strong>Author:</strong></a> <br><br>Name: <a
href="/temp-test-ioccc/winners.html#Pierre-Philippe_Coupard">Pierre-Philippe
Coupard</a><br> Location: <a
href="/temp-test-ioccc/location.html#ZZ">ZZ</a></p>

<!-- END: next line ends content generated by: bin/gen-author.sh -->
<h2 id="to-build">To build:</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div>
<h2 id="to-use">To use:</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span></span></code></pre></div>
<h2 id="try">Try:</h2>
<p>If you have access to <code>/dev/audio</code> or
<code>/dev/sound/dsp</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span> <span class="op">&gt;</span> /dev/audio</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span> <span class="op">&gt;</span> /dev/sound/dsp</span></code></pre></div>
<p>If you do not, first install <a
href="https://en.wikipedia.org/wiki/SoX">sox</a>. If you use macOS you
might install it from <a href="https://www.macports.org">MacPorts</a> or
<a href="https://brew.sh">Homebrew</a>. Then you can try:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span> <span class="kw">|</span> <span class="fu">sox</span> <span class="at">-q</span> <span class="at">-traw</span> <span class="at">-r8000</span> <span class="at">-b8</span> <span class="at">-e</span> unsigned-integer <span class="at">-</span> <span class="at">-tcoreaudio</span></span></code></pre></div>
<h2 id="judges-remarks">Judges’ remarks:</h2>
<p>You may need to run this a few times to understand exactly what is
being said. You might even need to look somewhere on your desktop, your
arm or the wall for confirmation.</p>
<h2 id="authors-remarks">Author’s remarks:</h2>
<p>Past years’ IOCCC entries do many marvellous things in small
packages, such as console utilities, games, math, languages or even X
applications. But they all have one thing in common (despite being hard
to read obviously): when they interact with the user, they only
<em>display</em> things, i.e. they display either text or drawings.</p>
<p>So, for a change, this program titillates the sense of hearing
instead of sight: this program is a self-contained speech synthesizer
that tells the current time through the computer’s sound card - in just
under 2 Kb of source code !</p>
<p>In the 2001 IOCCC <a href="/2001/rules.txt">rules</a> and <a
href="/2001/guidelines.txt">guidelines</a> documents, there is no
mention of what is or isn’t acceptable regarding audio I/O, but it is
mentioned that hardware-specific and/or non-portable programs are not
welcome. So, in order to do audio and satisfy those requirements, the
format required by <code>/dev/audio</code> has been chosen:
<code>/dev/audio</code> is a rather ancient fixed-format audio interface
that is supported by the majority of Unices that can do sound, as a
lowest-denominator sound I/O interface.</p>
<h3 id="program-usage">Program usage</h3>
<p>To listen to what the program says directly, invoke</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span> <span class="op">&gt;</span> /dev/audio</span></code></pre></div>
<p>The program then speaks out something like</p>
<blockquote>
<p>The time is HH hours MM minutes SS seconds</p>
</blockquote>
<p>in military time (24 hours). Of course, you need to have permissions
to write to <code>/dev/audio</code>, have your sound card enabled, the
volume up, the speakers connected … :-)</p>
<p>If you want to convert the audio output of the program into another
audio format, you can pipe it to <a
href="https://en.wikipedia.org/wiki/SoX">SoX</a> for example
(<code>sox</code> is the Swiss army knife of Unix audio tools). The
command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./coupard</span> <span class="kw">|</span> <span class="fu">sox</span> <span class="at">-c1</span> <span class="at">-r8000</span> <span class="at">-tub</span> <span class="at">-</span> <span class="at">-c2</span> <span class="at">-r44100</span> <span class="at">-twav</span> test.wav</span></code></pre></div>
<p>converts the output of the program into a 44.1KHz stereo .WAV file
and saves it into <code>test.wav</code>.</p>
<p>The output format of the program is 8KHz, unsigned 8-bit samples.</p>
<p>NOTE: the program’s return code is meaningless.</p>
<h3 id="audio-quality">Audio quality</h3>
<p>The quality of the sound produced by the program is cross between a
<a
href="https://en.wikipedia.org/wiki/Tin_can_telephone">yogurt-pot-and-string
telephone</a> and a bad <a
href="https://en.wikipedia.org/wiki/Phonograph">gramophone</a>, i.e. the
S/N ratio is very low and the signal’s top frequency is very low as
well. This is because the audio is stored internally at a sampling rate
of 4KHz (the <a
href="https://en.wikipedia.org/wiki/Nyquist_frequency">Nyquist
frequency</a> is only 2KHz) with only 4-bit samples (adding 24db of
quantization noise to an already poor signal).</p>
<p>In short, you might have to listen twice to understand what the
program is saying. 2048 bytes including the sound generation program
doesn’t leave much room for audio quality ;-)</p>
<h3 id="speech-generation">Speech generation</h3>
<p>Only 9 phonemes are used to generate the speech. Beside the limited
number of words the program has to generate (66 words), the low sound
quality is actually exploited to take liberties with certain consonants
(for example, <code>s</code> and <code>f</code> sound very much the same
at 4KHz, so they can be merged into one phoneme). Because the <a
href="https://en.wikipedia.org/wiki/Psychoacoustics">psychoacoustic</a>
context around those phonemes is just sufficient, the words can be
interpreted correctly most of the time despite the fact that they are
pronounced quite wrongly.</p>
<p>Internally, a table is used to generate most of the words, and
composite words such as “thirty-five” are made up by the C code
externally.</p>
<h3 id="data-compression">Data compression</h3>
<p>Even at 4KHz / 4 bits, the weight of all the phoneme samples and the
word-to-phonemes table put together is over 1600 bytes, which is well
over 2048 bytes when encoded in a C string made of printable characters.
Therefore, a compression method was needed that’s both efficient and
with a decompressor that is implementable in the shortest amount of code
possible. GSM compression is very good, but needs large psychoacoustic
tables to regenerate the original signal. Raw FFT spectral compression
is efficient too, but the decompression code can’t be made small
enough.</p>
<p>The best compression compromise was found using a simple Huffman
compressor, and encoding the compressed data by blocks of 13 bits in
pairs of printable ASCII characters: the raw data is compressed to 8465
bits, and the resulting C string is therefore about 1300 characters,
which leaves just enough room for the decompressor with a hard-coded
Huffman tree, and the code that plays the phonemes in the right
order.</p>
<h3 id="note-on-compiler-warnings-and-lint">Note on compiler warnings
and lint</h3>
<p>The program should build with <code>gcc -Wall -Werror -ansi</code>.
If the <code>-pedantic</code> flag is used, gcc will complain about the
length of the data string and the sign of its type, and also the fact
that <code>main()</code> returns with no value. The confusion with the
sign of the char type doesn’t matter with the data string because it’s
composed only of printable characters under 127.</p>
<p>When linting the program with <code>lclint</code>, it complains about
a huge list of things that, if corrected to make lint happy, would
probably double the size of the source code.</p>
<h2 id="copyright-and-cc-by-sa-4.0-license">Copyright and CC BY-SA 4.0
License:</h2>
<p>This file is Copyright (c) 2023 by Landon Curt Noll. All Rights
Reserved. You are free to share and adapt this file under the terms of
this license:</p>
<pre><code>Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)</code></pre>
<p>For more information, see:
https://creativecommons.org/licenses/by-sa/4.0/</p>
<!-- START: this line starts content generated by: bin/gen-inventory.sh -->

<h1 id="inventory-for-2001coupard"><a name="inventory"></a>Inventory for
2001/coupard</h1>
<h2 id="primary-files">Primary files</h2>
<ul>
<li><a href="index.html">index.html</a> - winner home page</li>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/coupard.c">coupard.c</a>
- winning source</li>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/Makefile">Makefile</a>
- winner Makefile</li>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/coupard.orig.c">coupard.orig.c</a>
- original source</li>
<li><a href="2001_coupard.tar.bz2">2001_coupard.tar.bz2</a> - download
winning source</li>
</ul>
<h2 id="secondary-files">Secondary files</h2>
<ul>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/.gitignore">.gitignore</a>
- list of files that should not be committed under git</li>
<li><a href=".path">.path</a> - directory path from top directory</li>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/.winner.json">.winner.json</a>
- description of winner in JSON</li>
<li><a
href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/2001/coupard/README.md">README.md</a>
- markdown source for index.html</li>
</ul>

<!-- END: next line ends content generated by: bin/gen-inventory.sh -->
<!-- START: this line starts content from: inc/after-content.default.html -->

<!-- END: this line ends content from: inc/after-content.default.html -->
<!-- START: this line starts content from: inc/end-rightcolumn.default.html -->

  </div>

<!-- END: this line ends content from: inc/end-rightcolumn.default.html -->
<!-- START: this line starts content from: inc/end-row.default.html -->

</div>

<!-- END: this line ends content from: inc/end-row.default.html -->
<!-- START: this line starts content from: inc/footer.default.html -->

<div class="footer">
  <hr>
  <h2>Coda</h2>
  <p><a href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fioccc-src.github.io%2Ftemp-test-ioccc%2F2001%2Fcoupard%2Findex.html">Nu HTML check this web page</a></p>
  <p><a href="#top">Jump to top</a> <a href="#content">Jump to Content</a> <a href="#inventory">Jump to Inventory</a></p>
</div>

<!-- END: this line ends content from: inc/footer.default.html -->
<!-- START: this line starts content from: inc/bottom.default.html -->

</body>
</html>

<!-- END: this line ends content from: inc/bottom.default.html -->
