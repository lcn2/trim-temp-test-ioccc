#
# md2html.cfg - markdown to HTML configuration

##########
# syntax #
##########

# Comments start with a # symbol and continue to the end of the line.

# Lines are of the form (without any leading whitespace or # of course):
#
#	file_glob [cfg_options ..]
#
# where 'file_glob' is a Bash Extended Glob (not a regular expression).
# and where 'cfg_options ..' are zero or more configuration file options.
#
# File paths are evaluated from under the top of the repo.  The file_glob should
# NOT start with a leading / and as assumed to be under the topdir directory.
#
# For information on Bash Extended Globbing, see:
#
#	https://www.linuxjournal.com/content/bash-extended-globbing
#	https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html
#
# For a given file, the first 'file_glob' Bash Extended Glob that matches is used.
# If no 'file_glob' matches, the file is ignored.
#
# Any 'options..' are processed between the options from the command line
# and any filename arguments on the command line.  For example:
#
#	command [command_options ..] [cfg_options ..] [output_tool_options ..] [--] [filename_arg ..]
#
# Here the 'command' first processes any command line options, then
# it processes 'cfg_options' obtained from this file from a 1st match of a given file_glob, then
# it processes 'output tool' (i.e., -o tool) options found in 'command_options', and 'cfg_options', then
# an optional -- (end of all options), then zero of more 'filename_arg' filename arguments.

##################
# import options #
##################

# While options might vary from command to command, there are some
# common options are required by tools that use this configuration file.
#
# NOTE: Where the comment references a shell variable (.e.g, $TOPDIR),
#	it is assumed that the command will set that value prior
#	to setting the USAGE variable.
#
#	-h		print help message and exit
#	-v level	set verbosity level (def level: $V_FLAG)
#	-V		print version string and exit
#
#	-n		go thru the actions, but do not update any files (def: do the action)
#	-N		do not process file, just parse arguments and ignore the file (def: process the file)
#
#	-d topdir	set topdir (def: $TOPDIR)
#			NOTE: -d may only be used in command_options (getopt phase 0)
#
#	-c md2html.cfg	Use md2html.cfg as the configuration file (def: use topdir/inc/md2html.cfg)
#			NOTE: -c may only be used in command_options (getopt phase 0)
#
#	-H phase=name	use 'phase.name.html' file for HTML phase named 'phase' (def: use 'phase.default.html')
#	-H phase=.	ignore processing for HTML phase 'phase' (def: process HTML phase)
#			NOTE: The 'phase' string may not contain an = (equal), a / (slash), a single-quote, nor a double-quote.
#			NOTE: The 'name' string may not contain an = (equal), a single-quote, nor a double-quote.
#			NOTE: The 'phase.name.html' file is assumed to be under the 'topdir/inc' directory.
#
#	-b tool		run 'before tool' during HTML phase number 20 (def: do not output before pandoc wrapper tool)
#	-b .		skip HTML phase number 20 (def: do nothing during HTML phase number 20)
#	-B optstr	run 'before tool' with options found in 'optstr' (def: do not add any options to 'before tool')
#			NOTE: The 'optstr' may not contain a single-quote, nor a double-quote.
#
#	-p tool		run 'pandoc wrapper tool' (not pandoc path) during HTML phase number 21 (def: use $PANDOC_WRAPPER)
#	-p .		skip HTML phase number 21 (def: do nothing during HTML phase number 21)
#			NOTE: The '-p tool' will be passed as leading options on the -b tool and -a tool command lines.
#	-P optstr	run 'pandoc wrapper tool' with options found in 'optstr' (def: $PANDOC_WRAPPER_OPTSTR)
#			NOTE: The 'optstr' may not contain a single-quote, nor a double-quote.
#			NOTE: The '-P optstr' will be passed as leading options on the -b tool and -a tool command lines.
#
#	-a tool		run 'after tool' during HTML phase number 20 (def: do not output after pandoc wrapper tool)
#	-a .		skip HTML phase number 22 (def: do nothing during HTML phase number 22)
#	-A optstr	run 'after tool' with options found in 'optstr' (def: do not add any options to 'after tool')
#			NOTE: The 'optstr' may not contain a single-quote, nor a double-quote.
#
#	-s token=value	substitute %%token%% with value except in HTML phase numbers 20-29 (def: do not substitute any tokens)
#			NOTE: The 'token' string may not contain a ; (semicolon), a = (equal), nor a % (percent).
#			NOTE: The 'value' string may not contain a ; (semicolon).
#			NOTE: A later '-s token=value' will override an earlier '-s token=value' for the same 'token'.
#			NOTE: Multiple '-s token=value' are cumulative for the unique set of 'token's.
#	-S		failure to replace a %%token%% is not an error (def: exit non-zero for non-substituted tokens)
#
#	-o tool		Use output tool, 'tool', to generate option lines (def: do not)
#	-o .		disable use of 'output tool' (def: do not use an 'output tool')
#			NOTE: -o may only be used in command_options and md2html.cfg cfg_options (getopt phases 0 and 2)
#	-O tool=optstr	run the 'token replace' named 'tool' with options found in 'optstr' (def: do not add any options)
#			NOTE: Neither 'tool' nor 'optstr' may not contain an = (equal), a single-quote, nor a double-quote.
#			NOTE: A later '-O tool=optstr' will override all earlier '-O tool=optstr' for the same 'tool'.
#			NOTE: -O may only be used in command_options and md2html.cfg cfg_options (getopt phases 0 and 2)
#
#	-u repo_url	Base level URL of target git repo (def: $REPO_URL)
#			NOTE: The '-u repo_url' is passed as leading options on -o tool, -b tool, and -a tool command lines.
#	-U top_url	Top level URL of web site where HTML files will be viewed (def: $TOP_URL)
#			NOTE: The '-U top_url' is passed as leading options on -o tool, -b tool, and -a tool command lines.
#
#	-e string	output 'string', followed by newline, to stderr (def: do not)
#	-E exitcode	force exit with exitcode (def: exit based on success or failure of the action)
#
# The output from 'before tool' (unless -b .) will be used in HTML phase number 20 (before pandoc wrapper processing).
# The output from 'pandoc wrapper tool' (unless -p .) will be used HTML phase number 21 (pandoc wrapper processing).
# The output from 'after tool' (unless -a .) will be used in HTML phase number 22 (after pandoc wrapper processing).
#
# When the 'before tool' (i.e., -b tool) is executed, it is given options found in the most recent
# 'optstr' (i.e., -B optstr), followed by '--', and ending in the path from the topdir
# to the file that matched the 'file_glob'.
#
# When the 'pandoc wrapper tool' (i.e., -p tool) is executed, it is given options found in the most recent
# 'optstr' (i.e., -P optstr), followed by '--', and ending in the path from the topdir
# to the file that matched the 'file_glob'.
#
# When the 'after tool' (i.e., -a tool) is executed, it is given options found in the most recent
# 'optstr' (i.e., -A optstr), followed by '--', and ending in the path from the topdir
# to the file that matched the 'file_glob'.
#
# When the 'options tool' (i.e., -o tool) is executed, it is given any options found in the most recent
# 'optstr' associated with 'tool' (i.e., -O tool=option), followed by '--', and ending in the path from the topdir
# to the file that matched the 'file_glob'.
#
# If the 'tool' path (for -b tool, -p tool, -a tool, -o tool) is not an absolute path, then it is assumed to be under topdir.
# If the 'tool' path is '.' (dot), then the use of the given tool is ignored.
#
# The 'optstr' is a quoted string of command line options to used with the respective tool.
# The command line options for the tool specific to the given tool and are not necessarily
# the command line options listed above.
#
# The command options are evaluated in the following getopt phases:
#
# getopt phase 0. parse command line options and save the argument at the end
#
#	NOTE: Depending on the program, the argument at the end is directory under topdir, or it is a file under topdir
#	NOTE: getopt phase 0 is the only getopt phase where "-d topdir" and "-c md2html.cfg" may be used.
#
# getopt phase 1. execute each -o "output tool" from getopt phase 0, parsing the output as a command line
#
#	NOTE: The -o "output tool" may be given optstr from "-O tool=optstr", followed by the phase 0 argument
#	NOTE: The -o "output tool" is not allowed to output another "-o tool", nor a "-O tool=optstr".
#	      Instead an -o "output tool" may execute another -o "output tool" merge the output into its own.
#
# getopt phase 2. parse the "cfg_options" from the first "md2html.cfg" line matched by saved argument
#
#	NOTE: The match is made with the (possibly modified) phase 0 argument
#
# getopt phase 3. execute each -o "output tool" from getopt phase 2, parsing the output as a command line
#
#	NOTE: The -o "output tool" may be given optstr from "-O tool=optstr", followed by the phase 0 argument
#	NOTE: The -o "output tool" is not allowed to output another "-o tool", nor a "-O tool=optstr".
#	      Instead an -o "output tool" may execute another -o "output tool" merge the output into its own.
#
# The '-o tool' must NOT output any '-o tool' options as '-o tool' is NOT RECURSIVE.  A '-o tool' is free, however,
# to execute other '-o tool' output tools and merge the output from those tools into its own.
#
# Most command line options override earlier copies of the same option.  However in the case of
# '-H phase=name', later '-H phase=name' only overrides an earlier use of '-H' for the same 'phase' only.
# Also in the case of '-s token=value', later '-s token=value' only overrides an earlier use of '-s'
# for the same 'token' only.
#
# When '-E exitcode' is evaluated, the application will exit with the 'exitcode' value.  If one wishes to also
# output a message to stderr, the '-e string' must come BEFORE any '-E exitcode' in the command line.
#
# All tokens (i.e., strings of the form '%%token%%') MUST be substituted (by some -s token=value)
# in all HTML output, except during phase numbers 20-29 (i.e., except 'before tool' output, pandoc wrapper output,
# and except 'after tool' output), or command will exit non-zero, unless -S is given.  If -S is given,
# only a warning about un-substituted tokens will be written to stderr.
#
# While above list is not a complete list of options, it does list options that are required of
# tools that use this configuration file.

#################
# Configuration #
#################

# Top level markdown files have no top navigation bar
#
# sort using: sort -d -u

CODE_OF_CONDUCT.md			-H topnav=. -o bin/subst.default.sh
README.md				-H topnav=. -o bin/subst.default.sh
bugs.md					-H topnav=. -o bin/subst.default.sh
contact.md				-H topnav=. -o bin/subst.default.sh
faq.md					-H topnav=. -o bin/subst.default.sh
index.md				-H topnav=. -o bin/subst.default.sh
judges.md				-H topnav=. -o bin/subst.default.sh
news.md					-H topnav=. -o bin/subst.default.sh
thanks-for-help.md			-H topnav=. -o bin/subst.default.sh
winners.md				-H topnav=. -o bin/subst.default.sh
www-history.md				-H topnav=. -o bin/subst.default.sh
years.md				-H topnav=. -o bin/subst.default.sh

# Year level README.md files have a special year navbar

[12][0-9][0-9][0-9]/README.md		-H topnav=year -o bin/subst.default.sh -o bin/subst.year.sh
mock/README.md				-H topnav=mock_year -o bin/subst.default.sh

# Navigation bar only moved up to the index for internal markdown files
#
# sort using: sort -d -u

1986/marshall/compilers.md		-H topnav=up2index -o bin/subst.default.sh
1991/brnstnd/sorta.README.md		-H topnav=up2index -o bin/subst.default.sh
1992/buzzard.2/buzzard.2.README.md	-H topnav=up2index -o bin/subst.default.sh
1993/ejb/hanoi.md			-H topnav=up2index -o bin/subst.default.sh
1993/ejb/patience.md			-H topnav=up2index -o bin/subst.default.sh
1993/rince/design.md			-H topnav=up2index -o bin/subst.default.sh
1994/shapiro/shapiro.md			-H topnav=up2index -o bin/subst.default.sh
1995/leo/spoiler1.md			-H topnav=up2index -o bin/subst.default.sh
1998/dorssel/dorssel.md			-H topnav=up2index -o bin/subst.default.sh
1998/schweikh1/macos.md			-H topnav=up2index -o bin/subst.default.sh
2004/gavin/gavin.md			-H topnav=up2index -o bin/subst.default.sh
2012/deckmyn/deckmyn.md			-H topnav=up2index -o bin/subst.default.sh
2012/hou/hint.md			-H topnav=up2index -o bin/subst.default.sh
2012/tromp/how.md			-H topnav=up2index -o bin/subst.default.sh
2013/hou/doc/example.md			-H topnav=up2index -o bin/subst.default.sh
2014/endoh1/spoilers.md			-H topnav=up2index -o bin/subst.default.sh
2015/burton/road.to.obscurity.md	-H topnav=up2index -o bin/subst.default.sh
2015/burton/spoilers.md			-H topnav=up2index -o bin/subst.default.sh
2018/burton2/discrepancies.md		-H topnav=up2index -o bin/subst.default.sh
2018/ferguson/rpm.md			-H topnav=up2index -o bin/subst.default.sh
2020/endoh2/spoiler/spoiler.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/COMPILING.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/HACKING.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/bugs.md			-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/cannibalism.log.md	-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/chocolate-cake.md	-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/crazy.log.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/gameplay.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/spoilers.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/terminals.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson1/troubleshooting.md	-H topnav=up2index -o bin/subst.default.sh
2020/ferguson2/chocolate-cake.md	-H topnav=up2index -o bin/subst.default.sh
2020/ferguson2/obfuscation.md		-H topnav=up2index -o bin/subst.default.sh
2020/ferguson2/recode.md		-H topnav=up2index -o bin/subst.default.sh

# Unless matched above, default process all winner README.md files

[12][0-9][0-9][0-9]/*/README.md		-o bin/subst.default.sh -o bin/subst.winner-index.sh -b bin/gen-author.sh -a bin/gen-inventory.sh
mock/*/README.md			-o bin/subst.default.sh -o bin/subst.winner-index.sh -b bin/gen-author.sh -a bin/gen-inventory.sh

# Exit 9 for any markdown file that we have not previously configured

*.md					-e "markdown file does not match any md2html.cfg line" -E 200

# Last, everything else is silently ignored

*					-N
