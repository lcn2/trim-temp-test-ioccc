<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- START: two lines up starts content from: inc/top.default.html -->

<!-- END: this line ends content from: inc/top.default.html -->
<!-- START: this line starts content from: inc/head.default.html -->

<head>
<link rel="stylesheet" href="../../ioccc.css">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>1998/schweikh1 - CPP Abuse</title>
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<meta name="description" content="1998 IOCCC entry schweikh1 - CPP Abuse">
<meta name="keywords" content="IOCCC, 1998, IOCCC 1998, IOCCC entry, schweikh1, CPP Abuse">
</head>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

<!-- END: this line ends content from: inc/head.default.html -->

<!-- -->
<!-- This web page was formed via the tool: bin/readme2index.sh -->
<!-- The content of main section of this web page came from: 1998/schweikh1/README.md -->
<!-- -->

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh1/README.md !!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh1/README.md !!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh1/README.md !!! -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

<!-- Markdown content was converted into HTML via the tool: bin/md2html.sh -->

<!-- START: this line starts content from: inc/body.default.html -->

<body>

<!-- END: this line ends content from: inc/body.default.html -->
<!-- START: this line starts content from: inc/header.default.html -->

<div class="header">
  <img src="../../png/ioccc.png" alt="IOCCC image by Matt Zucker" width=300 height=110>
  <h1>The International Obfuscated C Code Contest</h1>
  <h2>1998/schweikh1 - CPP Abuse</h2>
</div>

<!-- END: this line ends content from: inc/header.default.html -->
<!-- START: this line starts content from: inc/topnav.mid.html -->

<div class="topnav">
  <a class="Left" href="../schnitzi/index.html">&larr; schnitzi</a>
  <a class="Left" href="../index.html">&uarr; 1998 &uarr;</a>
  <a class="Left" href="../schweikh2/index.html">schweikh2 &rarr;</a>
  <a class="Right" href="https://github.com/ioccc-src/temp-test-ioccc/1998/schweikh1/schweikh1.c">C code</a>
  <a class="Right" href="https://github.com/ioccc-src/temp-test-ioccc/1998/schweikh1/Makefile">Makefile</a>
  <a class="Right" href="#inventory">Inventory</a>
</div>

<!-- END: this line ends content from: inc/topnav.mid.html -->
<!-- START: this line starts content from: inc/begin-row.default.html -->

<div class="row">

<!-- END: this line ends content from: inc/begin-row.default.html -->
<!-- START: this line starts content from: inc/begin-leftcolumn.default.html -->

  <div class="leftcolumn">

<!-- END: this line ends content from: inc/begin-leftcolumn.default.html -->
<!-- START: this line starts content from: inc/sidenav.default.html -->

    <div class="sidenav">
      <a href="#content">Jump to contents</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="../../index.html">IOCCC Home</a>
      <a href="../../years.html">Winning Entries</a>
      <a href="../../authors.html">People who have won</a>
      <a href="../../location.html">Location of authors</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="../../news.html">IOCCC News</a>
      <a href="../../status.html">Contest status</a>
      <a href="../../faq.html#submit">How to enter the IOCCC</a>
      <a href="../../faq.html">FAQ</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="../../bugs.html">Bugs &amp; (mis)features</a>
      <a href="../../faq.html#fix_an_entry">Fixing IOCCC entries</a>
      <a href="../../faq.html#fix_web_site">Fixing the web site</a>
      <a href="../../faq.html#fix_author">Fixing author info</a>
      <a href="../../thanks-for-help.html">Thanks for the help</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="../../judges.html">The IOCCC Judges</a>
      <a href="../../contact.html">Contacting the IOCCC</a>
    </div>
    <hr>
    <div class="sidenav">
      <a href="#top">Jump to top</a>
    </div>

<!-- END: this line ends content from: inc/sidenav.default.html -->
<!-- START: this line starts content from: inc/end-leftcolumn.default.html -->

  </div>

<!-- END: this line ends content from: inc/end-leftcolumn.default.html -->
<!-- START: this line starts content from: inc/begin-rightcolumn.default.html -->

  <div class="rightcolumn">

<!-- END: this line ends content from: inc/begin-rightcolumn.default.html -->
<!-- START: this line starts content from: inc/before-content.default.html -->

    <a name="content"></a>

<!-- END: this line ends content from: inc/before-content.default.html -->
<!-- START: this line starts content for HTML phase 20 by: bin/output-index-author.sh via bin/md2html.sh -->

<!-- START: this line starts content generated by: bin/output-index-author.sh -->

<h2 id="author"><a name="author"></a>Author:</h2>
<ul>
<li>Name: <a href="../../authors.html#Jens_Schweikhardt">Jens Schweikhardt</a><br>
Location: <a href="../../location.html#DE">DE</a> - <em>Federal Republic of Germany</em> (<em>Germany</em>)</li>
</ul>

<!-- END: next line ends content generated by: bin/output-index-author.sh -->

<!-- END: this line ends content for HTML phase 20 by: bin/output-index-author.sh via bin/md2html.sh -->
<!-- START: this line starts content for HTML phase 21 by: bin/pandoc-wrapper.sh via bin/md2html.sh -->

<h2 id="to-build">To build:</h2>
<pre class="&lt;!---sh--&gt;"><code>    make all</code></pre>
<p>There is an alternate version of this entry that will work with macOS. See the
<a href="#alternate-code">Alternate code</a> section below. We recommend you look at it
even if you don’t have a Mac, unless you want to figure it out yourself, as it
includes some interesting details about the entry.</p>
<h2 id="to-use">To use:</h2>
<pre class="&lt;!---sh--&gt;"><code>    ./schweikh1</code></pre>
<h2 id="alternate-code">Alternate code:</h2>
<p>As noted above this entry will not work as it stands for macOS and there are
some important notes as well as a description of how the fixed version works
(the details of which are relevant to the original entry that no longer works as
well as the fixed version but are described in the context of the macOS
adjustments). For details of what had to change, see <a href="macos.html">macos.html</a>.
Unless you wish to figure it out yourself, we recommend that you read this even
if you don’t have a Mac as it has some interesting details about the entry.</p>
<h3 id="alternate-build">Alternate build:</h3>
<pre class="&lt;!---sh--&gt;"><code>    make alt</code></pre>
<h3 id="alternate-build-1">Alternate build:</h3>
<p>Use <code>schweikh1.alt</code> as you would <code>schweikh1</code> above.</p>
<h3 id="alternate-try">Alternate try:</h3>
<p>Bonus exercise: modify the code to provide a different compiler.</p>
<h2 id="judges-remarks">Judges’ remarks:</h2>
<p>What does it do? It seems to print a list of system headers, perhaps
with words after them. Curiously, if you look at the list of words
defined in a given standard header, they are never printed directly
after that header’s name. Aha! It’s a conformance test for the
standard headers.</p>
<p>This code is a wonder; it’s a wonder that it compiles. I wonder
whether or not it should. The innovative realization that you can
use special characters, such as <code>'\n'</code>, in <code>#file</code> directives alone
merits some recognition.</p>
<p>I’ve included most of the author’s remarks; they’re fairly thorough.
Do not read them if you want to figure this out yourself. “Amendment
One” refers to “NA1”, the add-on to C89 which added some fairly
crufty internationalization support.</p>
<h4 id="historical-note">Historical note:</h4>
<p>Some non-gcc compilers that were not fully ANSI standard did not
compile this entry correctly. Using cc by default was not helpful
most of the time on this entry, because the program had a hardcoded
gcc invocation anyway. Anyone who uses egcs and has no plain gcc
will need to frob the source anyway and can be expected to do the
right thing with <code>${CC}</code>. This limitation was removed in 2023 but in the past
one should have used gcc.</p>
<h2 id="authors-remarks">Author’s remarks:</h2>
<p>Important! This program, if it compiles at all, is mis-compiled by many
compilers due to compiler bugs. It could be the “least likely
to compile and execute” in conjunction with preprocessor abuse.
When run, it is likely to uncover bugs in your system headers.</p>
<p>The program is run without arguments. If your compiler is buggy,
the most likely result is no output and/or an exit status of 1.</p>
<p>If Amendment One headers are missing you will see something like:</p>
<pre><code>    &lt;iso646.h&gt;:
    gcc: /usr/include/iso646.h: No such file or directory
    gcc: No input files specified
    &lt;wctype.h&gt;:
    gcc: /usr/include/wctype.h: No such file or directory
    gcc: No input files specified
    &lt;wchar.h&gt;:
    gcc: /usr/include/wchar.h: No such file or directory
    gcc: No input files specified</code></pre>
<p>Bug your vendor for an upgrade.</p>
<p>The format of the info file is straightforward and described in the file
itself. Just load it in your favorite editor.</p>
<h3 id="requirements">Requirements</h3>
<p><code>gcc</code> (the GNU C compiler) must be available at runtime. It is assumed that your
C implementation keeps headers as files in the <code>/usr/include</code> directory. The
<a href="info">info</a> file must be readable and reside in the current working directory.
The current working directory must be writable in order to create a temporary
file (which is removed upon program termination). In case you don’t have gcc at
runtime, not all is lost if your compiler or preprocessor can produce a list of
defined macros in the format output by <code>gcc -dM</code>, i.e. lines of the form
<code>#define MACRO value</code>.</p>
<p>Edit the source at line 55 in this case.</p>
<h3 id="background">Background</h3>
<p>ISO C has a very strict idea of visibility of identifiers. All possible
macros are explicitly enumerated. In a compliant implementation no other
macros can be defined, because you could write strictly conforming
programs that may fail to compile due to syntax errors: supposing that
<code>&lt;stdio.h&gt;</code> defines <code>PIPE_BUF</code>, then the conforming</p>
<pre class="&lt;!---c--&gt;"><code>    #include &lt;assert.h&gt;
    #include &lt;stdio.h&gt;    /*  &lt;- or where the bogus macro is defined */
    #include &lt;string.h&gt;
    #define STR(x) #x
    #define XSTR(x) STR(x)
    int main (void)
    {
       int PIPE_BUF = 0;
       assert (strcmp (&quot;PIPE_BUF&quot;, XSTR (PIPE_BUF)) == 0);
       return 0;
    }</code></pre>
<p>is expected to compile and meet the assertion. If it does not, your
compiler compiles some other language than ISO C.</p>
<h3 id="why-i-think-my-program-is-obfuscated">Why I think my program is obfuscated</h3>
<p>Not only is the program’s purpose a thorough standard conformance
test, the source itself is a beast and has uncovered bugs in many
C compilers.</p>
<ol type="1">
<li>The token sequence after <code>#include</code> can consist of pp-tokens and
“are processed just as in normal text.” [ISO 6.8.2] The result
must resemble one of the canonical forms, <code>"foo.h"</code> or <code>&lt;bar.h&gt;</code>.
This lets us write things like</li>
</ol>
<pre class="&lt;!---c--&gt;"><code>    #define HEADER &quot;foo.h&quot;
    #include HEADER</code></pre>
<p>I could not find a compiler rejecting this. However, if we’re
torturing the preprocessor a little more, by using token pasting,
at least one compiler falls over.</p>
<pre class="&lt;!---c--&gt;"><code>    #define H(x) &lt;st##x##.h&gt;
    #include H(dio)              /* expands to &lt;stdio.h&gt; */</code></pre>
<p>is rejected by tcc version 4.1.2, the TenDRA compiler:
<code>"t.c", line 3: Error:\    [ISO 6.8.3.3]: Invalid result for '##' operator in macro 'H'.</code></p>
<p>To be honest, I don’t know if the rules for pp-tokens and token
pasting don’t forbid what I do (and thus tcc is correct in rejecting it).
In this case, all other compilers I tried are buggy, or the Standard
itself :-)</p>
<ol start="2" type="1">
<li>The <code>#line</code> directive allows to set a line number, and optionally
a file name, i.e. modify <code>__LINE__</code> and <code>__FILE__</code>. Strange things
happen if the file name contains a NUL byte – which the Standard
allows: in <code>#line num "file"</code> the <code>"file"</code> is an s-char-sequence per
ISO 6.8.4. ISO 6.1.4 defines string literals as s-char-sequences,
which may include octal escape sequences. Let’s look at</li>
</ol>
<pre class="&lt;!---c--&gt;"><code>    #include &lt;stdio.h&gt;
    #line 42 &quot;foo\0bar&quot;
    int main (void) {
       printf (&quot;%s %d\n&quot;, __FILE__, (int)sizeof __FILE__);
       return 0;
    }</code></pre>
<p>This is supposed to output <code>'foo 8'</code>. Here’s what happens in RL:</p>
<pre><code>    foo 4        gcc 2.7.2.1, lcc
    foo\0bar 9   tcc 4.1.2, Sunsoft cc turn &quot;\0&quot; into &quot;\\0&quot;, ugh!</code></pre>
<p>(I have written a bug report for gcc. Newer versions and egcs are ok.)</p>
<ol start="3" type="1">
<li><p>The <code>%:</code> and <code>%:%:</code> digraphs test for conformance to Amendment One.</p>
<p>Ask your local guru if C allows the same case label in the same switch
statement to appear more than once. Ask him/her to think real hard.
The answer will be “no”. The true guru will cite a constraint in
ISO 6.6.4.2. Then make fun of the guru’s answer by waving <code>case __LINE__:</code>
under his/her nose. Easy money from a bet! Make sure your guru has
no chance to use Standardese weasel words as an escape: can I have</p></li>
</ol>
<pre class="&lt;!---c--&gt;"><code>    case &lt;some_token&gt;:
    case &lt;some_token&gt;:</code></pre>
<p>in the same switch? (Note that you need the [invisible] newline. You
can generously allow the additional constraint that no <code>#undef</code>s or
<code>#define</code>s are allowed between the two cases.)</p>
<p>Lots of integer constants and string literals come into the source
via <code>__LINE__</code> and <code>__FILE__</code> which are redefined at various places.
Sometimes the <code>__FILE__</code> contains <code>\0</code> bytes; different strings or
characters are then accessed with offsets, say <code>10+__FILE__</code> or
<code>__LINE__+__FILE__</code> or <code>2[__FILE__]</code>. One integral constant in octal.
This makes the source and header input depend on ASCII.</p>
<p>A few old obfuscations, like one character identifiers, not too
many macros, a <code>goto O</code>, “needless” assignments to satisfy lint
with its “function value ignored” warnings. My lint has nothing
to complain about.</p>
<p>There’s more whitespace in the Standard than just space, tab and newline. In
particular, there are vertical tab and form-feed that can be used in certain
places (outside of preprocessing directives, i.e. they are not allowed from just
after the <code>#</code> up to the final newline. See 6.8 for details.) On many
implementations these appear as <code>^L</code> and <code>^K</code>. My source starts with an
extremely uncommon 32bit word consisting of <code>^L</code>, <code>^K</code>, <code>%</code> and <code>:</code>. I have
grepped old winning entries for ^K, none of them contains one, so this is
something new – after 14 years of IOCCC. Be sure to have enough paper in your
printer when you make a hard copy of the source…</p>
<p>While I’m at it, the rules state that only space, tab and newline
are ignored for the count (plus ‘<code>{</code>’, ‘<code>}</code>’, ‘<code>;</code>’ followed by
whitespace). The <a href="../mkentry.c">mkentry.c</a> program, however, uses <code>isspace(3)</code> which
returns nonzero for <code>\v</code> and <code>\f</code> and other characters as well.
I could have used a lot more <code>^K</code> and <code>^L</code> probably undetected by your
counter but decided to err on the side of safety. I use a perl
script to compute the character count according to the rules.
The advantages of an independent clean room approach…</p>
<pre class="&lt;!---perl--&gt;"><code>    #!/usr/bin/perl -w
    $/ = &quot;\0&quot;;
    $_ = &lt;&gt;;
    s/[;{}][ \t\n]/\n/g;
    s/[ \t\n]+//g;
    print length ($_),&quot;\n&quot;;</code></pre>
<p>To use, try:</p>
<pre class="&lt;!---sh--&gt;"><code>    perl ./charcount.pl schweikh1.c</code></pre>
<p>I have tried, as suggested in the guidelines, to let the code look
like ordinary C code. Apart from a few long lines I think I left
the indentation like I would in RL. You should however not try to
use <code>indent</code> on the source. The code is extremely fragile because of the
myriads of <code>__LINE__</code> macros – indenting is a sure way to break
the program. Don’t even think of maintaining that beast; I’ve
had my share of core dumps during development :-) A test suite
was used after every minor change to find out if the program still
does what it should.</p>
<p>From the goals: “To stress C compilers with unusual code.”
That describes exactly my modest attempts…</p>
<!--

    Copyright © 1984-2024 by Landon Curt Noll. All Rights Reserved.

    You are free to share and adapt this file under the terms of this license:

        Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)

    For more information, see:

        https://creativecommons.org/licenses/by-sa/4.0/

-->

<!-- END: this line ends content for HTML phase 21 by: bin/pandoc-wrapper.sh via bin/md2html.sh -->
<!-- START: this line starts content for HTML phase 22 by: bin/output-index-inventory.sh via bin/md2html.sh -->

<!-- START: this line starts content generated by: bin/output-index-inventory.sh -->

<h1 id="inventory-for-1998schweikh1"><a name="inventory"></a>Inventory for 1998/schweikh1</h1>
<p><a href="#top">Jump to top</a></p>
<h2 id="primary-files">Primary files</h2>
<ul>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/schweikh1.c">schweikh1.c</a> - entry source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/Makefile">Makefile</a> - entry Makefile</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/schweikh1.alt.c">schweikh1.alt.c</a> - alternative source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/schweikh1.orig.c">schweikh1.orig.c</a> - original source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/charcount.pl">charcount.pl</a> - character counter</li>
<li><a href="macos.html">macos.html</a> - work with macOS</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/info">info</a> - standards compliance</li>
<li><a href="1998_schweikh1.tar.bz2">1998_schweikh1.tar.bz2</a> - download entry</li>
</ul>
<h2 id="secondary-files">Secondary files</h2>
<ul>
<li><a href="index.html">index.html</a> - this web page</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/README.md">README.md</a> - markdown source for index.html</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/.entry.json">.entry.json</a> - description of entry in JSON</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/.gitignore">.gitignore</a> - list of files that should not be committed under git</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh1/macos.md">macos.md</a> - markdown source for marcos.html</li>
<li><a href=".path">.path</a> - directory path from top directory</li>
</ul>

<!-- END: next line ends content generated by: bin/output-index-inventory.sh -->

<!-- END: this line ends content for HTML phase 22 by: bin/output-index-inventory.sh via bin/md2html.sh -->
<!-- START: this line starts content from: inc/after-content.default.html -->

<!-- END: this line ends content from: inc/after-content.default.html -->
<!-- START: this line starts content from: inc/end-rightcolumn.default.html -->

  </div>

<!-- END: this line ends content from: inc/end-rightcolumn.default.html -->
<!-- START: this line starts content from: inc/end-row.default.html -->

</div>

<!-- END: this line ends content from: inc/end-row.default.html -->
<!-- START: this line starts content from: inc/footer.default.html -->

<!--

    Copyright © 1984-2024 by Landon Curt Noll. All Rights Reserved.

    You are free to share and adapt this file under the terms of this license:

	Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)

    For more information, see:

	https://creativecommons.org/licenses/by-sa/4.0/

-->

<div class="footer">
  <h2>Copyright and CC BY-SA 4.0 License</h2>
  <p>This file and web page is:</p>
  <blockquote><b>Copyright &copy; 1984-2024 by Landon Curt Noll. All Rights Reserved.</b></blockquote>
  <p>You are free to share and adapt this file under the terms of this license:</p>
  <blockquote><b>Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)</b></blockquote>
  <p>For more information, see:</p>
  <blockquote><a
    href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</a></blockquote>
  <h2>Coda</h2>
  <p><a href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fioccc-src.github.io%2Ftemp-test-ioccc%2F1998%2Fschweikh1%2Findex.html">Nu HTML check this web page</a></p>
  <p><a href="#top">Jump to top</a> <a href="#content">Jump to Content</a> <a href="#inventory">Jump to Inventory</a></p>
</div>

<!-- END: this line ends content from: inc/footer.default.html -->
<!-- START: this line starts content from: inc/bottom.default.html -->

</body>
</html>

<!-- END: this line ends content from: inc/bottom.default.html -->
