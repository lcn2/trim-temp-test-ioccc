<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- START: two lines up starts content from: inc/top.default.html -->

<!-- END: this line ends content from: inc/top.default.html -->
<!-- START: this line starts content from: inc/head.default.html -->

<head>
<link rel="stylesheet" href="../../ioccc.css">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>1998/schweikh3 - Most Space Efficient</title>
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<meta name="description" content="1998 IOCCC entry schweikh3 - Most Space Efficient">
<meta name="keywords" content="IOCCC, 1998, IOCCC 1998, IOCCC entry, schweikh3, Most Space Efficient">
</head>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!! DO NOT MODIFY THIS FILE - This file is generated by a tool !!! -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

<!-- END: this line ends content from: inc/head.default.html -->

<!-- -->
<!-- This web page was formed via the tool: bin/readme2index.sh -->
<!-- The content of main section of this web page came from: 1998/schweikh3/README.md -->
<!-- -->

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh3/README.md !!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh3/README.md !!! -->
<!-- !!! Do not modify this web page, instead modify the file: 1998/schweikh3/README.md !!! -->
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

<!-- Markdown content was converted into HTML via the tool: bin/md2html.sh -->

<!-- START: this line starts content from: inc/body.default.html -->

<body>

<!-- END: this line ends content from: inc/body.default.html -->
<!-- START: this line starts content from: inc/topbar.default.html -->

<div class="theader">
  <nav class="topbar">
    <div class="container">
      <div class="logo">
        IOCCC
      </div>

      <div class="topbar-items">
        <div class="item">
          <span class="item-header">
            Home
          </span>

          <div class="sub-item">
            <div class="outfit-font"><a href="../../index.html">IOCCC Home</a></div>
            <div class="outfit-font"><a href="../../years.html">Winning Entries</a></div>
            <div class="outfit-font"><a href="../../authors.html">People who have won</a></div>
            <div class="outfit-font"><a href="../../location.html">Location of authors</a></div>
          </div>
        </div>

        <div class="item">
          <span class="item-header">
            News
          </span>

          <div class="sub-item">
            <div class="outfit-font"><a href="../../news.html">IOCCC News</a></div>
            <div class="outfit-font"><a href="../../status.html">Contest status</a></div>
            <div class="outfit-font"><a href="../../next/index.html">Rules and Guidelines</a></div>
            <div class="outfit-font"><a href="../../faq.html#submit">How to enter the IOCCC</a></div>
            <div class="outfit-font"><a href="../../faq.html">FAQ</a></div>
          </div>
        </div>

        <div class="item">
          <span class="item-header">
            Bugs
          </span>

          <div class="sub-item">
            <div class="outfit-font"><a href="../../bugs.html">Bugs &amp; (mis)features</a></div>
            <div class="outfit-font"><a href="../../faq.html#fix_an_entry">Fixing IOCCC entries</a></div>
            <div class="outfit-font"><a href="../../faq.html#fix_web_site">Fixing the web site</a></div>
            <div class="outfit-font"><a href="../../faq.html#fix_author">Fixing author info</a></div>
            <div class="outfit-font"><a href="../../thanks-for-help.html">Thanks for the help</a></div>
          </div>
        </div>

        <div class="item">
          <span class="item-header">
            Judges
          </span>

          <div class="sub-item">
            <div class="outfit-font"><a href="../../judges.html">The IOCCC Judges</a></div>
            <div class="outfit-font"><a href="../../contact.html">Contacting the IOCCC</a></div>
          </div>
        </div>
      </div>
    </div>
  </nav>
</div>

<!-- END: this line ends content from: inc/topbar.default.html -->
<!-- START: this line starts content from: inc/header.default.html -->

<div class="header">
  <img src="../../png/ioccc.png" alt="IOCCC image by Matt Zucker" width=300 height=110>
  <h1>The International Obfuscated C Code Contest</h1>
  <h2>1998/schweikh3 - Most Space Efficient</h2>
</div>

<!-- END: this line ends content from: inc/header.default.html -->
<!-- START: this line starts content from: inc/navbar.mid.html -->

<div class="navbar">
  <a class="Left" href="../schweikh2/index.html">&larr; schweikh2</a>
  <a class="Left" href="../index.html">&uarr; 1998 &uarr;</a>
  <a class="Left" href="../tomtorfs/index.html">tomtorfs &rarr;</a>
  <a class="Right" href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/schweikh3.c">C code</a>
  <a class="Right" href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/Makefile">Makefile</a>
  <a class="Right" href="#inventory">Inventory</a>
  <a class="Right" href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fioccc-src.github.io%2Ftemp-test-ioccc%2F1998%2Fschweikh3%2Findex.html">&#x2713;</a>
</div>

<!-- END: this line ends content from: inc/navbar.mid.html -->
<!-- START: this line starts content from: inc/before-content.default.html -->

    <div class="content" id="content">

<!-- END: this line ends content from: inc/before-content.default.html -->
<!-- START: this line starts content for HTML phase 20 by: bin/output-index-author.sh via bin/md2html.sh -->

<!-- START: this line starts content generated by: bin/output-index-author.sh -->

<h2 id="author">Author:</h2>
<ul>
<li>Name: <a href="../../authors.html#Jens_Schweikhardt">Jens Schweikhardt</a><br>
Location: <a href="../../location.html#DE">DE</a> - <em>Federal Republic of Germany</em> (<em>Germany</em>)</li>
</ul>

<!-- END: next line ends content generated by: bin/output-index-author.sh -->

<!-- END: this line ends content for HTML phase 20 by: bin/output-index-author.sh via bin/md2html.sh -->
<!-- START: this line starts content for HTML phase 21 by: bin/pandoc-wrapper.sh via bin/md2html.sh -->

<!-- BEFORE: 1st line of markdown file: 1998/schweikh3/README.md -->
<h2 id="to-build">To build:</h2>
<pre><code>    make all</code></pre>
<p>The author stated:</p>
<pre><code>    In the remote event that the input has more than `8192` files with
    the same size (on systems where `sizeof (char *) == 4`, or `4096` when
    `sizeof (char *) == 8`), increase the manifest constant 32767 on line
    31.</code></pre>
<p>An alternate version allows one to fix this; see <a href="#alternate-code">alternate
code</a> below.</p>
<h2 id="to-use">To use:</h2>
<p>If <code>dir</code> is the directory (or a directory tree) where you keep
all your favorite pictures off the Internet or from
<code>alt.binaries.pictures.*</code>, do</p>
<pre><code>    find dir -type f -print | ./samefile</code></pre>
<p>Maybe you will not need to buy another 10 GB disk to store them. :-)</p>
<h2 id="try">Try:</h2>
<p>If you’re in this winning entry’s directory:</p>
<pre><code>    ./try.sh</code></pre>
<p>Notice that the tool finds some files that are duplicates.</p>
<h2 id="alternate-code">Alternate code:</h2>
<p>If you run into the problem that the author described (above) you can redefine
the size as described; this was done with the <code>SZ</code> macro defined in the Makefile
which if (in the code) is unset will be set to the default, 32767.</p>
<h3 id="alternate-build">Alternate build:</h3>
<p>If you wish to change the size to say, 55555:</p>
<pre><code>    make clobber SIZE=55555 alt</code></pre>
<p>or whatever you wish to redefine it to.</p>
<h2 id="judges-remarks">Judges’ remarks:</h2>
<p>This program is not as smart as to detect identity of JPEG files with the same
picture but with different compression levels. On the other hand compression can
make a thing look/sound/feel different so these probably aren’t duplicates
anyway. :-)</p>
<p>Some time after this entry won, the Internet Systems Consortium (ISC) added the
samefile utility to its treasure of software gems! See the author’s page about
the tool as well at <a href="http://www.schweikhardt.net/samefile" class="uri">http://www.schweikhardt.net/samefile</a>.</p>
<h2 id="authors-remarks">Author’s remarks:</h2>
<p>The source is expected to conform to IEEE Std 1003.1-1990 (“POSIX”).
Thank God the IEEE does not standardize a coding style…</p>
<h3 id="what-this-program-does">What this program does</h3>
<p>This is best explained in the man page. The troff source for this
man page can be found in the file <a href="samefile.1">samefile.1</a>. To render try:</p>
<pre><code>    `man ./samefile.1</code></pre>
<p>Otherwise:</p>
<h3 id="samefile1-user-manuals-samefile1">SAMEFILE(1) User Manuals SAMEFILE(1)</h3>
<h4 id="name">NAME</h4>
<p><code>samefile</code> - find identical files</p>
<h4 id="synopsis">SYNOPSIS</h4>
<pre><code>    ./samefile</code></pre>
<h4 id="description">DESCRIPTION</h4>
<p><code>samefile</code> reads a list of file names (one file name per
line) from <code>stdin</code>. For each file name pair with identical
contents, a line consisting of six tab separated fields is
output: The size in bytes, two file names, the character
<code>=</code> if the two files are on the same device, <code>X</code> otherwise,
and the link counts of the two files. The output
is sorted in reverse order by size.</p>
<p><code>samefile</code> uses two stages to give optimum performance.</p>
<p>In the first stage, all non-plain files are silently
ignored (directories, devices, FIFOs, sockets, symbolic
links) as well as files for which <code>stat(2)</code> or <code>open(2)</code>
fails. The result of the first stage (the file names) is
written into a binary tree with one node for every file
size. Each node is in turn a linked list of file names
along with inode and device information. It is also at
this first stage where checks for hard links are done.
For any inode only one filename will be added to the
binary tree.</p>
<p>In the second stage all files having the same size are
compared against each other. The rules of mathematical
logic are applied to reduce work and output noise: if
files <code>A</code>, <code>B</code>, and <code>C</code> have the same size and samefile finds
that <code>A = B</code> and <code>A = C</code> then it will not compare <code>B</code> against <code>C</code>
(and will not output a line for <code>B</code> and <code>C</code>) but only for <code>A = B</code> and <code>A = C</code>. The algorithm will detect equality across
arbitrarily long chains. Note however, that because only
the first filename per inode gets into the first stage,
the output for a group of identical files with different
inode numbers is also minimized. Suppose you have six
identical files of size 100 in an inode group consisting
of the three inodes with numbers 10, 20 and 30:</p>
<pre><code>    $ ls -i   # output edited for readability:
      10 file1     20 file4     30 file6
      10 file2     20 file5
      10 file3
    $ ls | ./samefile
    100     file1   file4   =       3       2
    100     file1   file6   =       3       1</code></pre>
<p>The sum of the sizes in the first column is the amount of
disk space you could gain by making all 6 files links to
only one file or remove all but one of the files. To be
precise, disk space is allocated in blocks - you will
probably gain two blocks here, rather than 200 bytes.
Note that it is not enough to just remove <code>file4</code> and <code>file6</code>
(you would gain only 100 bytes because <code>file5</code> still
exists.)</p>
<h4 id="limitations">LIMITATIONS</h4>
<p><code>samefile</code> was written with no limits in mind. The number of
input lines is unlimited. The size of the actual files is
only limited by available virtual memory needed to compare
one pair of files. The only hard limit is the constraint
that there should not be more than about <code>8192</code> files having
the same size. Experience has shown that there are rarely
more than a couple dozen files of the same size.</p>
<h4 id="examples">EXAMPLES</h4>
<p>For everybody:</p>
<p>What are the duplicates under my home directory?</p>
<pre><code>    find $HOME | ./samefile</code></pre>
<p>For the sysadmin folks:</p>
<p>Report all duplicate files under /usr larger than 16k:</p>
<pre><code>    find /usr -size +16384c -a -type f | ./samefile</code></pre>
<p>For the ftp and WWW admins:
How much space is wasted below our site’s /pub directory?</p>
<pre><code>    find /pub -type f | samefile | awk &#39;{sum += $1} END {print sum}&#39;</code></pre>
<h4 id="exit-status">EXIT STATUS</h4>
<p>If <code>samefile</code> runs out of memory the exit status is 1, zero
otherwise.</p>
<h4 id="see-also">SEE ALSO</h4>
<p><code>find(1)</code>, <code>ln(1)</code>, <code>rm(1)</code></p>
<h3 id="why-i-think-it-is-obfuscated">Why I think it is obfuscated</h3>
<ul>
<li>The code is commented but this gives only an <em>extremely</em> faint clue.</li>
<li>The layout does not reflect the program structure, or does it?</li>
<li>The data structure the program builds is an ordered binary tree
where each node consists of a linked list. This is probably too
heavy to comprehend for N percent of all programmers ;-)</li>
<li>The tree is built and traversed by recursive function calls.</li>
<li>Why does this program look at <code>dev_t</code> and <code>ino_t</code>? Heavy wizardry.</li>
<li>Can you find out how the algorithm works that detects identity
of files across arbitrarily long chains? In my private unobfuscated
source there are 17 lines describing just that. A classical case for
the well known <code>/* You're not supposed to understand this */</code> comment.</li>
<li>Would Dijkstra consider this <code>goto</code> harmful?</li>
<li>The only string literal is split in more than a dozen substrings.</li>
<li>For the task at hand the code is pretty terse. Some dynamic memory
is even freed as soon as it’s no longer needed. I have tried to
make the preprocessor directives as short as possible. This means
no spaces after <code>#include</code> and no spaces after some of the macro
names.</li>
</ul>
<p>Are you an algorithms guru? If so you should know why the output
appears sorted without any use of <code>qsort(3)</code> or <code>system("sort")</code>.</p>
<p>Rewrite (hah!) the program to use memory mapping of files instead
of <code>read(2)</code>. Does this affect performance noticeably?</p>
<p>It’s easy to write a script that takes <code>samefile</code>’s output and
hard links (or symlinks) identical files. Writing such a script is
left as an exercise for the deobfuscator.</p>
<p>When you run <code>samefile</code> on some directory tree, try to estimate
how much you think it will find. Is the actual result anywhere
near your estimate? How many copies of the GPL <code>COPYING</code> file
are there on your filesystems? :-)</p>
<p>In the remote event that the input has more than <code>8192</code> files with
the same size (on systems where <code>sizeof (char *) == 4</code>, or <code>4096</code> when
<code>sizeof (char *) == 8</code>), increase the manifest constant 32767 on line
31.</p>
<!--

    Copyright © 1984-2024 by Landon Curt Noll. All Rights Reserved.

    You are free to share and adapt this file under the terms of this license:

        Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)

    For more information, see:

        https://creativecommons.org/licenses/by-sa/4.0/

-->
<!-- AFTER: last line of markdown file: 1998/schweikh3/README.md -->

<!-- END: this line ends content for HTML phase 21 by: bin/pandoc-wrapper.sh via bin/md2html.sh -->
<!-- START: this line starts content for HTML phase 22 by: bin/output-index-inventory.sh via bin/md2html.sh -->

<!-- START: this line starts content generated by: bin/output-index-inventory.sh -->

<div id="inventory">
<h1 id="inventory-for-1998schweikh3">Inventory for 1998/schweikh3</h1>
</div>
<h2 id="primary-files">Primary files</h2>
<ul>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/schweikh3.c">schweikh3.c</a> - entry source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/Makefile">Makefile</a> - entry Makefile</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/schweikh3.alt.c">schweikh3.alt.c</a> - alternative source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/schweikh3.orig.c">schweikh3.orig.c</a> - original source</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/samefile.1.dupe">samefile.1.dupe</a> - samefile man page</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/samefile.1">samefile.1</a> - samefile man page</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/try.sh">try.sh</a> - how to run</li>
</ul>
<h2 id="secondary-files">Secondary files</h2>
<ul>
<li><a href="1998_schweikh3.tar.bz2">1998_schweikh3.tar.bz2</a> - download entry tarball</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/README.md">README.md</a> - markdown source for this web page</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/.entry.json">.entry.json</a> - description of entry in JSON</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/.gitignore">.gitignore</a> - list of files that should not be committed under git</li>
<li><a href="https://github.com/ioccc-src/temp-test-ioccc/blob/master/1998/schweikh3/.path">.path</a> - directory path from top directory</li>
<li><a href="index.html">index.html</a> - this web page</li>
</ul>
<hr style="width:10%;text-align:left;margin-left:0">
<h4>
Jump to: <a href="#">top</a>
</h4>

<!-- END: next line ends content generated by: bin/output-index-inventory.sh -->

<!-- END: this line ends content for HTML phase 22 by: bin/output-index-inventory.sh via bin/md2html.sh -->
<!-- START: this line starts content from: inc/after-content.default.html -->

    </div>

<!-- END: this line ends content from: inc/after-content.default.html -->
<!-- START: this line starts content from: inc/footer.default.html -->

<!--

    Copyright © 1984-2024 by Landon Curt Noll. All Rights Reserved.

    You are free to share and adapt this file under the terms of this license:

	Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)

    For more information, see:

	https://creativecommons.org/licenses/by-sa/4.0/

-->

<div class="footer">
  <div id="copyright"><h2>Copyright and CC BY-SA 4.0 License</h2></div>
  <p>All IOCCC content including this file and web page are:</p>
  <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright &copy; 1984-2024 by Landon Curt Noll. <a href="https://creativecommons.org/faq/#what-does-some-rights-reserved-mean">Some Rights Reserved</a>.</b>
  <p>This work is licensed by Landon Curt Noll under:</p>
  <p><b><a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1"
  target="_blank" rel="license noopener noreferrer" style="display:inline-block;">&nbsp;&nbsp;&nbsp;&nbsp;CC BY-SA 4.0
  <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
  src="../../png/cc.png"
  alt="cc inside circle symbol">
  <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
  src="../../png/by.png"
  alt="person inside circle symbol">
  <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
  src="../../png/sa.png"
  alt="arrow looping back on itself inside circle symbol">
  </a></b></p>
  <p>The <b>CC BY-SA 4.0 LEGAL CODE</b> for this license is found under:</p>
  <p>&nbsp;&nbsp;&nbsp;<b><a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode.en">
  https://creativecommons.org/licenses/by-sa/4.0/legalcode.en</a></b></p>
  <p>You should <b>carefully review</b> all of the terms and conditions of the
  <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode.en">actual license</a>
  before using the licensed material.</p>
  <p>You may wish to review the <b><a href="../../license.html">highlights of some of the key
  features and terms</a></b> of the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode.en">actual license</a>.</p>
  <h2>Coda</h2>
  <p><a href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fioccc-src.github.io%2Ftemp-test-ioccc%2F1998%2Fschweikh3%2Findex.html">Nu HTML check this web page</a></p>
  <p><a href="#top">Jump to top</a> <a href="#content">Jump to Content</a> <a href="#inventory">Jump to Inventory</a></p>
</div>

<!-- END: this line ends content from: inc/footer.default.html -->
<!-- START: this line starts content from: inc/bottom.default.html -->

</body>
</html>

<!-- END: this line ends content from: inc/bottom.default.html -->
